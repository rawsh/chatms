<% if user_signed_in? %>
	<div class="mcbox">
	<% @messages.where(:article_type => "Idea").each do |message| %>
		<div class="post col-md-6">
			<div class="message">
				<p class="message-description"><%= message.description %></p>
				<p class="message-posted-by">posted by <%= link_to message.user.username, user_path(message.user) %> <%= time_ago_in_words(message.created_at) %> ago</p>
				<%= 
				if message.image?
					image_tag(message.image.url, style: 'max-width:100%;' )
				end
				%>
				<% if message.user_id == current_user.id %>
					<div class="links">
						<%= link_to "Edit", edit_message_path(message) %>
						<%= link_to "Delete", message_path(message), method: :delete, data: { confirm: "Are you sure?" } %>
					</div>
				<% end %>
				<hr />
				<% if message.comments.length > 0 %>
				<p id="comments" style="color:white;" >Showing <%= (message.comments.length > 2) ? 3 : message.comments.length %>/<a href="/messages/<%= message.id.to_s %>#comments"><%= message.comments.length %></a> comments.</p>
				<div style="color:white;"><%= render message.comments[0,3] %></div>
				<br />
				<a href="/messages/<%= message.id.to_s %>#comments">View more comments.</a>
				<br />
				<br />
				<% end %>
				<%= simple_form_for([message, message.comments.build]) do |f| %>
					<%= f.input :content, label: false, :class => 'textarea' %>
					<%= f.submit "Post Comment", :class => 'btn btn-sm', :onClick => "reloadComments(event)" %>
				<% end %>
				<br />
			</div>
		</div>
	<% end %>
	</div>
<% else %>
	<h3>Please log in to view the discussion.</h3>
<% end %>

<script>
	$(document).ready(function () {
    var container = $('.mcbox');

    container.imagesLoaded( function () {
	  container.masonry({
	    itemSelector: '.post'
	  });   
	});
});
</script>